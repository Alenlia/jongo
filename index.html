<!DOCTYPE html>
<!--
  ~ Copyright (C) 2011 Benoit GUEROUT <bguerout at gmail dot com> and Yves AMSELLEM <amsellem dot yves at gmail dot com>
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Jongo</title>

    <link href="assets/img/jongo.ico" rel="shortcut icon">
    <link href="assets/boostrap/jongo.less" type="text/css" rel="stylesheet/less" data-env="dev">
    <link href="assets/css/prettify.css" type="text/css" rel="stylesheet"/>


    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="http://lesscss.googlecode.com/files/less-1.2.1.min.js" data-env="dev"></script>
	<script type="text/javascript" src="assets/js/prettify.js"></script>
    <script type="text/javascript" src="assets/boostrap/js/bootstrap-dropdown.js"></script>

</head>

<body onload="prettyPrint()">

<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="i-bar"></span>
                <span class="i-bar"></span>
                <span class="i-bar"></span>
            </a>
            <a class="brand" href="#">Jongo</a>
			<div class="nav-collapse">
          <ul class="nav">
			<li><a href="#mapping">Mapping</a></li>
            <li><a href="#querying">Querying</a></li>
            <li><a href="#updating">Updating</a></li>
            <li><a href="#advanced">Advanced</a></li>
			<li><a href="#maven">Maven</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Follow<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="https://github.com/bguerout/jongo" target="_blank">code on github</a></li>
                <li><a href="https://twitter.com/#!/bguerout" target="_blank">@bguerout</a></li>
                <li><a href="https://twitter.com/#!/amsellemyves" target="_blank">@amsellemyves</a></li>
              </ul>
            </li>
          </ul>
          <ul class="nav pull-right">
			<li><a href="https://oss.sonatype.org/index.html#nexus-search;gav~org.jongo~jongo~0.1-SNAPSHOT~~" target="_blank">Current version : 0.1-SNAPSHOT</a></li>
          </ul>
        </div>
        </div>
    </div>
</div>


<div class="container">

<section id="overview">
    <div class="row">
        <div class="span12 intro">
                
            <h1><img src="assets/img/jongo60x74.png">Jongo</h1>

            <div class="row">
                <div class="span12 pitch">
                    Using Mongo with it's Java driver can be <strong>tricky</strong><br>Jongo makes it way <strong>easy</strong>
                </div>
            </div>

            <div class="row">
                <div class="span9 offset2">
					<span class="label">Shell</span>
                    <pre class="prettyprint maincode">db.peoples.find({"age": {$gt: 18}});</pre>
					
					<span class="label label-warning">Java Driver</span>
                    <pre class="prettyprint maincode">peoples.find(new BasicDBObject("age",new BasicDBObject("$gt", 18)));</pre>

					<span class="label label-success">Jongo</span>
                    <pre class="prettyprint maincode">peoples.find("{age: {$gt: 18}}").as(People.class);</pre>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="offset1">
	<div class="page-header">
		<h1>Usage</h1>
	</div>
	<div class="row">
		<div class="span9">
		   <pre class="prettyprint">
Mongo mongo = new Mongo("localhost" , 27017);
Jongo jongo = new Jongo(mongo.getDB("dbname"));
MongoCollection peoples = jongo.getCollection("peoples");

Iterable&lt;People&gt; all = peoples.find("{}").as(People.class);
People one = peoples.findOne("{}").as(People.class);</pre>
		</div>
	</div>
</section>

<section id="mapping" class="offset1">
	<div class="page-header">
		<h1>Object Mapping</h1>
	</div>
	<div class="row">
		<div class="span9">
			<p>
			By default, Jongo uses Jackson to (un)marshall objects: <strong>a no-arg constructor, even private</strong>, is enought to write an object into Mongo and read from it.
			</p>
			<p>
			Note that every Mongo document have an <code>_id</code> field. Defining this field Java side can be done two ways: the object field can be named <code>_id</code> or annotated with <code>@JsonProperty("_id")</code>. The object type can be <code>ObjectId</code> – it will be generated Mongo side – or any Java type, other than array, so long as it is unique.
			</p>
			<p>
			Careful, saving a document without <code>_id</code> will generate an <code>ObjectId</code> typed field, even if the Java object define another type for it. So, not choosing <code>ObjectId</code> for _id field involves always to set it before persisting.
			</p>
		</div>
	</div>
	<div class="row">
		<div class="span3">
<pre class="prettyprint">
public class People {
    private ObjectId _id;
}
 </pre>
		</div>
		<div class="span3">
<pre class="prettyprint">
public class People {
    @JsonProperty("_id")
    private ObjectId key;
}</pre>
		</div>
		<div class="span3">
<pre class="prettyprint">
public class People {
    // you must generate it!
    private String _id; 
}</pre>
		</div>
	</div>
	<div class="row">
		<div class="span9">
			<p>
			As expected with Jackson, fields are automaticaly mapped to their equivalent json properties (<i>and complex types mapped as sub-properties</i>). No extra annotations needed. For fine grained control over (un)marshalling, refer to <a href="http://wiki.fasterxml.com/JacksonDocumentation" target="_blank">Jackson documentation</a> or use <a href="#">your own (un)marshaller</a>.
			</p>
			<h3>Handling polymorphism</h3>
			<p>
			To handle polymorphism of Java objects, a field containing the class name must be set into the Mongo document. One can persist a <code>Fox</code> (<i>sub-class of <code>Animal</code></i>) and manipulate it as an <code>Animal</code>. This feature is provided out-of-the-box by Jackson. Using another (un)marshaller implies extra work.
			</p>

<pre class="prettyprint">
@JsonTypeInfo(use = Id.CLASS, include = As.PROPERTY, property = "_class")
public class Animal {
    String gender;
}</pre>

<pre class="prettyprint">
public class Fox extends Animal {
    boolean wild;
}</pre>
			<p>
			Using a singular <i>reserved</i> name, like <code>_class</code>, for this field is a good idea.
			</p>
		</div>
	</div>
</section>

<section id="querying" class="offset1">
	<div class="page-header">
		<h1>Querying</h1>
	</div>

	<div class="row">
		<div class="span9">

			<h3>Find and FindOne</h3>
			<p>
			Query syntax is almost the same as in Mongo shell: copy/paste, it just works. 
			<br>Strings have to be escaped with single quotes <code>"{name: 'John'}"</code>, numbers don't <code>"{age: 18}"</code>. 
			</p>
		
<pre class="prettyprint">Iterable&lt;People&gt; all = peoples.find("{name: 'John'}").as(People.class);</pre>
<pre class="prettyprint">
People john = peoples.findOne("{name: 'John'}").as(People.class);
People john = peoples.findOne(new ObjectId("4c...e")).as(People.class);</pre>

			<p>
			Field names only need quotes when using dot notation <code>"{'address.city': 'London'}"</code>.
			</p>

			<h3>Query with parameters</h3>
			<p>
			Queries can be templated: add anchors <code>#</code> as follow <code>peoples.find("{name: #, age: #}", 'John', 18)</code><br>
			Binded parameters can be <a href="http://stackoverflow.com/questions/3725386/java-types-in-org-bson-bsonobject">BSON Primitives</a> or any complex type made of those.
			</p>

<pre class="prettyprint">peoples.find("{name: #, age: #}", 'John', 18); //-> will produce {name: 'John', age: 18}</pre>

<pre class="prettyprint">
List&lt;String&gt; ages = Lists.newArrayList(22, 63);
peoples.find("{age: {$in:#}}", ages); //-> will produce {age: {$in:[22,63]}}</pre>

			<h3>Query options</h3>
			<h4>Field selection</h4>

			<p>
			Field selection aka. partial loading is not written as in Mongo shell:
			Jongo exposes a <code>fields(...)</code> method. A json selector must be provided: <code>{field: 1}</code> to include it, <code>{field: 0}</code> to exclude it.
			</p>
			<pre class="prettyprint">peoples.find("{}").fields("{lastname: 1, address: 1}").as(User.class);</pre>

			<h4>Sorting</h4>

			<p>Documents can be sorted in ascending or descending order using a json selector: <code>{field: 1}</code> for ascending, <code>{field: -1}</code> for descending.
			</p>
			<pre class="prettyprint">
peoples.find("{}").sort("{firstname: 1}").as(User.class);
peoples.find("{}").sort("{lasttname: -1}").as(User.class);</pre>

			<h4>Skip and Limit</h4>

			<p>Behaviour similar to Java driver <a href="http://api.mongodb.org/java/current/com/mongodb/DBCursor.html">DBCursor</a>.
			</p>
			<pre class="prettyprint">peoples.find("{}").skip(20).as(User.class);</pre>
			<pre class="prettyprint">peoples.find("{}").limit(10).as(User.class);</pre>

			<h4>Distinct</h4>

			<p>Behaviour similar to Java driver <a href="http://api.mongodb.org/java/current/com/mongodb/DBCollection.html#distinct(java.lang.String)">DBCollection.distinct(...)</a>.
			</p>
			<pre class="prettyprint">peoples.distinct("address", "", Address.class);</pre>
			<pre class="prettyprint">peoples.distinct("address", "{name: 'John'}", Address.class);</pre>

			<h4>Count</h4>

			<p>Behaviour similar to Java driver <a href="http://api.mongodb.org/java/current/com/mongodb/DBCollection.html#count()">DBCollection.count(...)</a>.
			</p>
			<pre class="prettyprint">peoples.count("{name: 'John'}");</pre>

			<h3>Advanced query</h3>
            <h4>Geospacial indexing</h4>

            <p>Using <a href="http://www.mongodb.org/display/DOCS/Geospatial+Indexing" target="_blank">Mongo geospacial capacities</a> requires an index and some BSON operators.</p>
<pre class="prettyprint">
peoples.ensureIndex("{address: '2d'}");
peoples.find("{address: {$near: [0, 0], $maxDistance: 5}}").as(Address.class);</pre>

            <h4>Complete query syntax</h4>
			<p>Mongo uses a <a href="http://www.mongodb.org/display/DOCS/Mongo+Query+Language">behind the scenes syntactic sugar</a> for methods like <code>sort(...)</code>, <code>limit(...)</code> and others. The complete expression can also be used in Jongo.
			</p>
             <pre class="prettyprint">
peoples.find("{$query: {}, $maxScan: 2}").as(People.class);
peoples.find("{$query: {}, $orderby: {name: 1}}").as(People.class);</pre>
		</div>
    </div>
</section>

<section id="updating" class="offset1">
    <div class="page-header">
        <h1>Updating</h1>
    </div>


    <div class="row">
        <div class="span9">
            <h3>Save</h3>

            <p>Simply pass an object to the <code>save(...)</code> method, built-in Jackson marshaller will be used to convert it to json. <a href="#mapping">Object mapping section</a> defines what objects have to look like.
            </p>
            <pre class="prettyprint">peoples.save(new People("Joe", 27));</pre>

            <h3>Update</h3>

            <p>In early version of Jongo 'upsert' is not available and update is always in 'multi' mode.</p>
            <pre class="prettyprint">peoples.update("{name: 'Joe'}", "{$inc: {age: 1}}");</pre>

            <h3>Remove</h3>

            <p>Remove works as if you were in Mongo shell.</p>
            <pre class="prettyprint">peoples.remove("{name: 'Joe'}");</pre>
        </div>
    </div>
</section>

<section id="advanced"  class="offset1">
	<div class="page-header">
		<h1>Advanced</h1>
	</div>
	<div class="row">
		<div class="span9">
			<h3>Using a custom result mapper</h3>
			<p>
			If one prefers to manually map objects (<i>ie. without a (un)marshaller</i>), he can implements
			<code>ResultMapper</code>. Each result entity will be passed to the inherited <code>map(String json)</code> method.
			</p>
			
<pre class="prettyprint">
Iterable&lt;Integer&gt; ages = col.find("{'name':'John'}").map(
    new ResultMapper&lt;Integer&gt;() {
        @Override
        public String map(String json) {
            DBObject result = (DBObject) JSON.parse(json);
            return result.get("age");
        }
    }
);</pre>

			<h3>Using a custom (un)marshaller</h3>
			<p>
			Instead of Jackson, one can provide his own implementation of <code>Marshaller</code> and <code>Unmarshaller</code>.
			</p>

<pre class="prettyprint">
Marshaller marshaller = new Marshaller() {
    @Override
    &lt;T&gt; String marshall(T obj) { ... }
};
Unmarshaller unmarshaller = new Unmarshaller() {
    @Override
    &lt;T&gt; T unmarshall(String json, Class&lt;T&gt; clazz) { ... }
};
Jongo jongo = new Jongo(mongo.getDB("dbname"), marshaller, unmarshaller);
</pre>


		</div>
	</div>
</section>

<section id="maven" class="offset1">
    <div class="page-header">
        <h1>Maven</h1>
    </div>

    <div class="row">
        <div class="span9">
			<p>Jongo is deployed into OSS Sonatype (Maven repository hosting service for open source projects).</p>

			<h5>Add dependency into your pom.xml</h5>

            <pre class="prettyprint linenums">
&lt;dependency&gt;
    &lt;groupId&gt;org.jongo&lt;/groupId&gt;
    &lt;artifactId&gt;jongo&lt;/artifactId&gt;
    &lt;version&gt;0.1-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</pre>
        
			<h5>To be able to resolve snapshot dependency, you have to add OSS repository into your settings.xml</h5>

			<pre class="prettyprint linenums">
&lt;settings&gt;
...
&lt;repositories&gt;
   &lt;repository&gt;
        &lt;id&gt;oss-sonatype&lt;/id&gt;
        &lt;name&gt;OSS Sonatype Repository&lt;/name&gt;
        &lt;url&gt;http://oss.sonatype.org/content/groups/public&lt;/url&gt;
        &lt;snapshots&gt;&lt;enabled&gt;true&lt;/enabled&gt;&lt;/snapshots&gt;
    &lt;/repository&gt;
&lt;/repositories&gt;
...
&lt;/settings&gt;</pre>
        </div>
    </div>
</section>

<hr>

<footer class="offset1">
    <a href="https://jongo.ci.cloudbees.com/"><img src="assets/img/cloudbees.png"></a>
</footer>

</div>


</body>
</html>
