

<!--
  ~ Copyright (C) 2011 Benoit GUEROUT <bguerout at gmail dot com> and Yves AMSELLEM <amsellem dot yves at gmail dot com>
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<head>
    <meta charset="utf-8">
    <title>Jongo {mongo-java-driver: 'with ease'}</title>

    <link href="assets/img/jongo_favicon.png" rel="shortcut icon">
    
    <link href="assets/css/bootstrap.min.css" type="text/css" rel="stylesheet">
    <link href="assets/css/prettify.css" type="text/css" rel="stylesheet">


    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
    
    <script type="text/javascript" src="assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="assets/js/bootstrap-scrollspy.js"></script>
    <script type="text/javascript" src="assets/js/bootstrap-dropdown.js"></script>
    <script type="text/javascript" src="assets/js/prettify.js"></script>
    <script type="text/javascript" src="assets/js/jongo.js"></script>

    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="pragma" content="no-cache">
    <meta charset="utf-8">
    <meta name="description" content="Query in Java as in Mongo shell (using strings), unmarshall results into Java objects (using Jackson)">

<link href="assets/css/jongo.css" type="text/css" rel="stylesheet"><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-30202616-1']);
_gaq.push(['_trackPageview']);

(function () {
    var ga = document.createElement('script');
    ga.type = 'text/javascript';
    ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(ga, s);
})();
</script></head>

<body data-spy="scroll">

<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="i-bar"></span>
                <span class="i-bar"></span>
                <span class="i-bar"></span>
            </a>
            <a class="brand" href="#overview">Jongo</a>

            <div class="nav-collapse">
                <ul class="nav">
                    <li><a href="#mapping">Mapping</a></li>
                    <li><a href="#updating">Updating</a></li>
                    <li><a href="#querying">Querying</a></li>
                    <li><a href="#advanced">Advanced</a></li>
                    <li><a href="#notes">Release notes</a></li>
                    <li><a href="#maven">Maven</a></li>
                </ul>
                <ul class="nav pull-right">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Community<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="https://groups.google.com/forum/?hl=fr&amp;fromgroups#!forum/jongo-user" target="_blank"><i class="icon-envelope icon-white"></i> Ask the mailing list</a></li>
                            <li><a href="https://github.com/bguerout/jongo" target="_blank"><i class="icon-download-alt icon-white"></i> Grab code on github</a></li>
                            <li><a href="https://twitter.com/#!/bguerout" target="_blank"><i class="icon-leaf icon-white"></i> Follow @bguerout</a></li>
                            <li><a href="https://twitter.com/#!/amsellemyves" target="_blank"><i class="icon-leaf icon-white"></i> Follow @amsellemyves</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Versions<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li> <a href="/">Current (0.2)</a></li>
                            <li><a href="tags/0.1/0.1.html">0.1 Documentation</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="container">

<section id="overview">
    <div class="row">
        <div class="span12 intro">

            <h1><img src="assets/img/jongo_big.png">Jongo</h1>

            <div class="row">
                <div class="span12 pitch">Query in <strong>Java</strong> as in <strong>Mongo</strong> shell</div>
            </div>

            <div class="row">
                <div class="span9 offset2">
                    <span class="label">Shell</span>
                    <pre class="prettyprint maincode">db.friends.find({"age": {$gt: 18}});</pre>

                    <span class="label label-warning">Java Driver</span>
                    <pre class="prettyprint maincode">friends.find(new BasicDBObject("age",new BasicDBObject("$gt", 18)));</pre>

                    <span class="label label-success">Jongo</span>
                    <pre class="prettyprint maincode">friends.find("{age: {$gt: 18}}").as(Friend.class);</pre>
                </div>
            </div>
        </div>
    </div>
</section>

<section id="usage" class="offset1">
    <div class="page-header">
        <h1>Usage</h1>
    </div>
    <div class="row">
        <div class="span9">
		   <pre class="prettyprint">
Mongo mongo = new Mongo("127.0.0.1" , 27017);
Jongo jongo = new Jongo(mongo.getDB("dbname"));
MongoCollection friends = jongo.getCollection("friends");

Iterable&lt;Friend&gt; all = friends.find("{name:'John'}").as(Friend.class);
Friend one = friends.findOne("{name:'John'}").as(Friend.class);</pre>
        </div>
    </div>
</section>

<section id="mapping" class="offset1">
    <div class="page-header">
        <h1>Object Mapping</h1>
    </div>
    <div class="row">
        <div class="span9">
            <p>
                By default, Jongo uses Jackson to (un)marshall objects: <strong>a no-arg constructor, even
                private</strong>, is enough to write an object into Mongo and read from it.
            </p>

            <p>
                Note that every Mongo document have an <code>_id</code> field. Just name id property <code>_id</code> or annotate it with
                <code>@JsonProperty("_id")</code>. The object type can be <code>ObjectId</code> – it will be generated
                Mongo side – or any Java type, other than array, so long as it is unique.
            </p>

            <p>
                Careful, saving a document with a custom <code>_id</code> type (ie: String, ...) involve always to set it before persisting.
            </p>
        </div>
    </div>
    <div class="row">
        <div class="span3">
<pre class="prettyprint">
public class Friend {
    private ObjectId _id;
}
&nbsp;</pre>
        </div>
        <div class="span3">
<pre class="prettyprint">
public class Friend {
    @JsonProperty("_id")
    private ObjectId key;
}</pre>
        </div>
        <div class="span3">
<pre class="prettyprint">
public class Friend {
    // you must generate it!
    private String _id;
}</pre>
        </div>
    </div>
    <div class="row">
        <div class="span9">
            <p>
                As expected with Jackson, fields are automatically mapped to their equivalent json properties (<i>and
                complex types mapped as sub-properties</i>). No extra annotations needed. For fine grained control over
                (un)marshalling, refer to <a href="http://wiki.fasterxml.com/JacksonDocumentation" target="_blank">Jackson
                documentation</a> or use <a href="#advanced">your own (un)marshaller</a>.
            </p>

            <h2>Handling polymorphism</h2>

            <p>
                To handle polymorphism of Java objects, a field containing the class name must be set into the Mongo
                document. One can persist a <code>Fox</code> (<i>sub-class of <code>Friend</code></i>) and manipulate it
                as a <code>Friend</code>. This feature is provided out-of-the-box by Jackson. Using another
                (un)marshaller implies extra work.
            </p>
        </div>
    </div>
    <div class="row">
        <div class="span5">
<pre class="prettyprint">
@JsonTypeInfo(use = Id.CLASS, property = "_class")
public class Friend {
    int age;
}</pre>
        </div>
        <div class="span4">
<pre class="prettyprint">
public class Fox extends Friend {
    String name, color;
}
&nbsp;</pre>
        </div>
    </div>
    <div class="row">
        <div class="span9">
<pre class="prettyprint">
friends.save(new Fox("fantastic", "red-haired"));
Friend friend = friends.findOne("{name:'fantastic'}").as(Friend.class);
Fox fantastic = (Fox)friend;</pre>

            <p>
                Using a singular <i>reserved</i> name, like <code>_class</code>, for this field is a good idea.
            </p>
        </div>
    </div>
</section>

<section id="updating" class="offset1">
    <div class="page-header">
        <h1>Updating</h1>
    </div>


    <div class="row">
        <div class="span9">
            <h2>Save</h2>

            <p>Simply pass an object to the <code>save(...)</code> method, built-in Jackson marshaller will be used to
                convert it to json. <a href="#mapping">Object mapping section</a> defines what objects have to look
                like.
            </p>
            <pre class="prettyprint">friends.save(new Friend("Joe", 27));</pre>

            <h2>Update</h2>

            <p>Update syntax is a bit different than in Mongo shell: 'modifier' query has to be passed using <code>with(...)</code> method.
            Upsert and multi options are no longer boolean but flag methods </p>
            <pre class="prettyprint">
friends.update("{name: 'Joe'}").with("{$inc: {age: 1}}");
friends.update("{name: 'Joe'}").upsert().multi().with("{$inc: {age: 1}}");
friends.update("{name: 'Joe'}").upsert().with("{$inc: {age: 1}}");</pre>
            <h2>Remove</h2>

            <p>Remove works as if you were in Mongo shell.</p>
<pre class="prettyprint">
friends.remove("{name: 'Joe'}");
friends.remove(new ObjectId("4c...e"));</pre>
        </div>
    </div>
</section>

<section id="querying" class="offset1">
    <div class="page-header">
        <h1>Querying</h1>
    </div>

    <div class="row">
        <div class="span9">

            <h2>Find and FindOne</h2>

            <p>
                Query syntax is almost the same as in Mongo shell: copy/paste, it just works.
                <br>Strings have to be escaped with single quotes <code>"{name: 'John'}"</code>, numbers don't <code>"{age:
                18}"</code>.
            </p>

            <pre class="prettyprint">Iterable&lt;Friend&gt; all = friends.find("{name: 'John'}").as(Friend.class);</pre>
<pre class="prettyprint">
Friend john = friends.findOne("{name: 'John'}").as(Friend.class);
Friend john = friends.findOne(new ObjectId("4c...e")).as(Friend.class);</pre>

            <p>
                Field names only need quotes when using dot notation <code>"{'address.city': 'London'}"</code>.
            </p>

            <h3>Field selection</h3>
            <p>
                Field selection aka. partial loading is not written as in Mongo shell:
                Jongo exposes a <code>fields(...)</code> method. A json selector must be provided: <code>{field:
                1}</code> to include it, <code>{field: 0}</code> to exclude it.
            </p>
            <pre class="prettyprint">friends.find("{}").fields("{lastname: 1, address: 1}").as(User.class);</pre>

            <h3>Sorting</h3>
            <p>Documents can be sorted in ascending or descending order using a json selector: <code>{field: 1}</code>
                for ascending, <code>{field: -1}</code> for descending.
            </p>
			<pre class="prettyprint">
friends.find("{}").sort("{firstname: 1}").as(User.class);
friends.find("{}").sort("{lasttname: -1}").as(User.class);</pre>

            <h3>Skip and Limit</h3>
            <p>Behaviour similar to Java driver <a href="http://api.mongodb.org/java/current/com/mongodb/DBCursor.html">DBCursor</a>.</p>
            <pre class="prettyprint">friends.find("{}").skip(20).as(User.class);</pre>
            <pre class="prettyprint">friends.find("{}").limit(10).as(User.class);</pre>

            <h2>Query templating</h2>

            <p>
                Almost all queries in Jongo can be templated: add anchors <code>#</code> as follow. Binded parameters can be <a href="http://stackoverflow.com/questions/3725386/java-types-in-org-bson-bsonobject">BSON
                Primitives</a> or any complex type made of those.
            </p>

            <pre class="prettyprint">friends.find("{name: #, age: #}", "John", 18); //→ will produce {name: 'John', age: 18}</pre>
<pre class="prettyprint">
List&lt;String&gt; ages = Lists.newArrayList(22, 63);
friends.find("{age: {$in:#}}", ages); //→ will produce {age: {$in:[22,63]}}</pre>

            <h2>Count</h2>
            <p>Behaviour similar to Java driver <a href="http://api.mongodb.org/java/current/com/mongodb/DBCollection.html#count()">DBCollection.count(...)</a>.</p>
            <pre class="prettyprint">friends.count("{name: 'John'}");</pre>

            <h2>Aggregation</h2>

            <h3>Distinct</h3>
            <p>Distinct syntax is almost the same as Find/FindOne operations. Optional query can be setted using <code>query(...)</code> method</p>
            <pre class="prettyprint">List&lt;String&gt; names = friends.distinct("name").as(String.class);</pre>
            <pre class="prettyprint">List&lt;Address&gt; addresses = friends.distinct("address").query("{name: 'John'}").as(Address.class);</pre>

            <h3>New Aggregation Framework</h3>
            <p>This feature will only be available in the Mongo v2.2 release and Jongo already supports it! 
            <br>Just use a v2.1.0+ (unstable) Mongo server.</p>
            <p>All aggregation operators are supported <code>$project, $match, $limit, $skip, $unwind, $group, $sort</code> and can be piped using <code>and(...)</code> method</p>
            <pre class="prettyprint">
collection.aggregate("{$project:{sender:1}}")
          .and("{$match:{tags:'read'}}")
          .and("{$limit:10}")
          .as(Email.class);</pre>

            <h2>Advanced query</h2>

            <h3>Geospacial indexing</h3>
            <p>Using <a href="http://www.mongodb.org/display/DOCS/Geospatial+Indexing" target="_blank">Mongo geospacial capacities</a> requires an index and some BSON operators.</p>
<pre class="prettyprint">
friends.ensureIndex("{address: '2d'}");
friends.find("{address: {$near: [0, 0], $maxDistance: 5}}").as(Address.class);</pre>

            <h3>Complete query syntax</h3>
            <p>Mongo uses a <a href="http://www.mongodb.org/display/DOCS/Mongo+Query+Language">behind the scenes
                syntactic sugar</a> for methods like <code>sort(...)</code>, <code>limit(...)</code> and others. The
                complete expression can also be used in Jongo.
            </p>
             <pre class="prettyprint">
friends.find("{$query: {}, $maxScan: 2}").as(Friend.class);
friends.find("{$query: {}, $orderby: {name: 1}}").as(Friend.class);</pre>
        </div>
    </div>
</section>

<section id="advanced" class="offset1">
    <div class="page-header">
        <h1>Advanced</h1>
    </div>
    <div class="row">
        <div class="span9">
            <h2>Using a custom result mapper</h2>

            <p>
                If one prefers to manually map objects (<i>ie. without unmarshaller</i>), he can implements
                <code>ResultMapper</code>. Each result entity will be passed to the inherited <code>map(DBObject result)</code> method.
            </p>
			
<pre class="prettyprint">
Iterable&lt;Integer&gt; ages = col.find("{'name':'John'}").map(
    new ResultMapper&lt;Integer&gt;() {
        @Override
        public Integer map(DBObject result) {
            //do manual stuff here
            return result.get("age");
        }
    }
);</pre>

            <h2>Using a custom (un)marshaller</h2>

            <p>
                Instead of Jackson, one can provide his own implementation of <code>Marshaller</code> and <code>Unmarshaller</code>.
            </p>

<pre class="prettyprint">
class CustomMarshaller implements Marshaller {
    &lt;T&gt; String marshall(T obj) { ... }
};

class CustomUnmarshaller implements Unmarshaller {
    &lt;T&gt; T unmarshall(String json, Class&lt;T&gt; clazz) { ... }
};

Jongo jongo = new Jongo(mongo.getDB("dbname"), customMarshaller, customUnmarshaller);
</pre>
            <h2>Using Jongo objects with Jersey</h2>

            <p>Because Jongo uses Jackson by default, the same objects cannot be exposed with Jersey if they have an <code>ObjectId</code>. To make Jongo and Jersey work together, use <a href="https://gist.github.com/3155831">this custom Jackson Provider</a>, it exposes <code>ObjectId</code> as <code>String</code>.</p>

            <p>If in doubt, <a href="https://github.com/yamsellem/jongo-jersey">this full working sample</a> put everything together.</p>

            <h2>Performance</h2>

            <p>Jongo is lighting fast. Not because it is made of ancient wood and magic stones, but because it binds
                Jackson — the fastest Java json (un)marshalling library — to Mongo Java driver with the slightest glue
                code possible.</p>

            <p>Jongo's performance is currently under our microscope and we already noticed some great improvements over
                our main competitor: Morphia. Keep tuned.</p>
        </div>
    </div>
</section>

<section id="notes" class="offset1">
    <div class="page-header">
        <h1>Release notes (0.1→0.2)</h1>
    </div>

    <div class="row">
        <div class="span9">
            <dl class="dl-horizontal">
                <dt class="strong">Aggregation Framework</dt><dd>support for the brand new aggregation framework, see <a href="#querying">querying</a> for more details</dd>
                <dt>WriteConcern</dt><dd><code>save()</code> and <code>update()</code> can be configured with a <a href="http://api.mongodb.org/java/current/com/mongodb/WriteConcern.html" target="_blank">WriteConcern</a></dd>
                <dt>WriteResult</dt><dd><code>save()</code>, <code>insert()</code>, <code>update()</code> and <code>remove()</code> return a <a href="http://api.mongodb.org/java/current/com/mongodb/WriteResult.html" target="_blank">WriteResult</a> for every call</dd>
                <dt>marshalling</dt><dd>move to Jackson 2.0 (<i>no conflict with olders Jackson versions</i>)</dd>
                <dt>save</dt><dd>when an <code>ObjectId</code> is generated Mongo-side, it is setted in the object <a href="#mapping">_id attribute</a></dd>
                <dt>update</dt><dd>breaking change <i class="icon-exclamation-sign"></i> <code>update(String, String)</code> becomes <code>update(String).with(String)</code></dd>
                <dt>remove</dt><dd>documents can be removed by id</dd>
                <dt>distinct</dt><dd>to be faithful to the driver, <code>distinct()</code> returns <code>List&lt;T&gt;</code> instead of <code>Iterable&lt;T&gt;</code></dd>
                <dt>find</dt><dd>query without filter can be writen with empty <code>find()</code> and <code>findOne()</code></dd>
            </dl>
        </div>
    </div>
</section>

<section id="maven" class="offset1">
    <div class="page-header">
        <h1>Maven</h1>
    </div>

    <div class="row">
        <div class="span9">
            <p>Jongo is deployed into OSS Sonatype (<i>Maven repository hosting service for open source projects</i>).</p>

            <h5>Add the following dependency to your pom.xml</h5>

            <pre class="prettyprint linenums">
&lt;dependency&gt;
    &lt;groupId&gt;org.jongo&lt;/groupId&gt;
    &lt;artifactId&gt;jongo&lt;/artifactId&gt;
    &lt;version&gt;0.2&lt;/version&gt;
&lt;/dependency&gt;</pre>

        </div>
    </div>
</section>

<hr>

<footer class="offset1">
    <a href="https://jongo.ci.cloudbees.com/"><img src="assets/img/cloudbees.png"></a>
</footer>

</div>

</body>
<script class="jsdom" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>